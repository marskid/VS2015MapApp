$(function () {
    // 百度地图API功能
    var map = window.map = new BMap.Map("baiduMap", { enableMapClick: false });    // 创建Map实例, 禁止地图景点弹出框
    map.setMapStyle({   //隐藏高速公路和景点图标
        style: 'googlelite',
        styleJson: [{
            "featureType": "highway",
            "elementType": "all",
            "stylers": {
                "visibility": "off"
            }
        }, {
            "featureType": "poi",
            "elementType": "all",
            "stylers": {
                "visibility": "off"
            }
        }]
    });
    map.centerAndZoom(new BMap.Point(121.315538, 31.278899), 5);  // 初始化地图,设置中心点坐标和地图级别
    map.centerAndZoom("上海", 12);          // 设置地图显示的城市 此项是必须设置的
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放

    WebApplication.WebService.GetDevices(function (devices) {
        var markers = [];
        $.each(devices, function (index, point) {
            var marker = new BMap.Marker(new BMap.Point(point.longitude, point.latitude), { title: point.name });
            marker.addEventListener("click", (function (point) {
                var opts = {
                    width: 200,
                    height: 100,
                    title: point.name,
                    enableMessage: true
                }
                return function (e) {
                    var infoWindow = new BMap.InfoWindow("<p> 纬度:" + point.latitude + "<p><p>经度:" + point.longitude +"</p>", opts);
                    e.target.openInfoWindow(infoWindow);
                }
            })(point));
            markers.push(marker);
        });
        var markerClusterer = new BMapLib.MarkerClusterer(map, { markers: markers }); //点聚合

        if (devices.length == 0 && window.console) {
            GenerateTestData(); //添加测试数据
        }
    }, function (err) {
        console.error(err);
    });
});

function GenerateTestData() {
    var zhengzhou = [{ "latitude": 34.80937293117212, "longitude": 113.4513947653721 }, { "latitude": 34.783191754023534, "longitude": 113.56558875336155 }, { "latitude": 34.74897603196312, "longitude": 113.44764612181409 }, { "latitude": 34.745144670370635, "longitude": 113.52255748880825 }, { "latitude": 34.799110718851345, "longitude": 113.42131234037689 }, { "latitude": 34.77897480375385, "longitude": 113.47711643031865 }, { "latitude": 34.71255546029764, "longitude": 113.53171593294063 }, { "latitude": 34.723222413890774, "longitude": 113.66742883062166 }, { "latitude": 34.78051452042481, "longitude": 113.79045116892672 }, { "latitude": 34.800984320130546, "longitude": 113.63225078556219 }, { "latitude": 34.800825891414036, "longitude": 113.86086569876088 }, { "latitude": 34.75998431165029, "longitude": 113.5005921057391 }, { "latitude": 34.790485396995045, "longitude": 113.50383917086515 }, { "latitude": 34.77562428702935, "longitude": 113.52068563439602 }, { "latitude": 34.7669424068225, "longitude": 113.51824736833667 }, { "latitude": 34.74482411542859, "longitude": 113.72493128544839 }, { "latitude": 34.73539262216144, "longitude": 113.74201812516942 }, { "latitude": 34.79017085874705, "longitude": 113.85246384216042 }, { "latitude": 34.79468513485897, "longitude": 113.43670662190964 }, { "latitude": 34.80560907665089, "longitude": 113.83435805807878 }, { "latitude": 34.730255410788665, "longitude": 113.87208292413511 }, { "latitude": 34.72213512435529, "longitude": 113.46268207484864 }, { "latitude": 34.737537029765974, "longitude": 113.85400099084434 }, { "latitude": 34.77892532533901, "longitude": 113.68436703946432 }, { "latitude": 34.72739408778014, "longitude": 113.41662591014956 }, { "latitude": 34.7468546523413, "longitude": 113.58752765472755 }, { "latitude": 34.696986350893404, "longitude": 113.6822265942751 }, { "latitude": 34.76611107413772, "longitude": 113.56963257832774 }, { "latitude": 34.74461699845052, "longitude": 113.41892431858204 }, { "latitude": 34.72279095339127, "longitude": 113.83499246090946 }, { "latitude": 34.76811675793018, "longitude": 113.79009073717376 }, { "latitude": 34.70396346630064, "longitude": 113.4359193764633 }, { "latitude": 34.74619695951386, "longitude": 113.77898257616462 }, { "latitude": 34.756352453215044, "longitude": 113.53692340266299 }, { "latitude": 34.753776525187014, "longitude": 113.46783728024958 }, { "latitude": 34.73874776541083, "longitude": 113.8526501921362 }, { "latitude": 34.716894343397136, "longitude": 113.58601595829978 }, { "latitude": 34.80382529387855, "longitude": 113.77730467900187 }, { "latitude": 34.71522430363487, "longitude": 113.52788616847666 }, { "latitude": 34.73823418157894, "longitude": 113.69180330759596 }, { "latitude": 34.793902256248124, "longitude": 113.78200537250235 }, { "latitude": 34.797194292529085, "longitude": 113.47380802254872 }, { "latitude": 34.71536788671654, "longitude": 113.51931559317964 }, { "latitude": 34.72059611291039, "longitude": 113.41963440509835 }, { "latitude": 34.763269333438735, "longitude": 113.41914228938356 }, { "latitude": 34.71881247570004, "longitude": 113.52811212791505 }, { "latitude": 34.794375556219464, "longitude": 113.54324103726547 }, { "latitude": 34.805461164495895, "longitude": 113.84634470831045 }, { "latitude": 34.70929274729984, "longitude": 113.4682636765412 }, { "latitude": 34.80777724202625, "longitude": 113.3972135604704 }, { "latitude": 34.71405885540665, "longitude": 113.5122102776016 }, { "latitude": 34.71819214362736, "longitude": 113.50896744829303 }, { "latitude": 34.76579938928499, "longitude": 113.53788164606941 }, { "latitude": 34.71319209607918, "longitude": 113.51845926372495 }, { "latitude": 34.75379885096393, "longitude": 113.52456328975217 }, { "latitude": 34.73596149344194, "longitude": 113.77899879963856 }, { "latitude": 34.7800324087384, "longitude": 113.54024551050547 }, { "latitude": 34.768664982966826, "longitude": 113.88230239815272 }, { "latitude": 34.799554446189696, "longitude": 113.60797646158244 }, { "latitude": 34.71919916832213, "longitude": 113.87665018371199 }, { "latitude": 34.730745815404724, "longitude": 113.60393975803306 }, { "latitude": 34.77408839299341, "longitude": 113.5541997048071 }, { "latitude": 34.74793650458165, "longitude": 113.64695581932511 }, { "latitude": 34.77511287404104, "longitude": 113.65200581013764 }, { "latitude": 34.77072753290405, "longitude": 113.52063154868323 }, { "latitude": 34.79337166492758, "longitude": 113.87269852965571 }, { "latitude": 34.70349294041869, "longitude": 113.54221774578413 }, { "latitude": 34.74228542192799, "longitude": 113.72849658139397 }, { "latitude": 34.79612692933804, "longitude": 113.40631199173174 }, { "latitude": 34.74931854416672, "longitude": 113.61877017397745 }, { "latitude": 34.711515486801424, "longitude": 113.73849767854061 }, { "latitude": 34.765667487036815, "longitude": 113.54170498331185 }, { "latitude": 34.79460912542141, "longitude": 113.44755242658178 }, { "latitude": 34.724310588656316, "longitude": 113.57039925773775 }, { "latitude": 34.80668926218921, "longitude": 113.60694706463669 }, { "latitude": 34.78573532693226, "longitude": 113.41703188923785 }, { "latitude": 34.738924801989846, "longitude": 113.46384883495436 }, { "latitude": 34.76053535391951, "longitude": 113.5704791858268 }, { "latitude": 34.76675137484472, "longitude": 113.87245906946175 }, { "latitude": 34.788677575406204, "longitude": 113.48563756321721 }, { "latitude": 34.76452548794703, "longitude": 113.66372115527643 }, { "latitude": 34.752362105604, "longitude": 113.68608251656968 }, { "latitude": 34.788733222483884, "longitude": 113.54229287353343 }, { "latitude": 34.723953492052, "longitude": 113.60628783758014 }, { "latitude": 34.732574052781594, "longitude": 113.48448126310976 }, { "latitude": 34.78629732293837, "longitude": 113.56555256926617 }, { "latitude": 34.784455310518304, "longitude": 113.80181920410665 }, { "latitude": 34.71882469766878, "longitude": 113.6533085204172 }, { "latitude": 34.762458267301916, "longitude": 113.55191933711936 }, { "latitude": 34.70120653743091, "longitude": 113.83877477143791 }, { "latitude": 34.794345403740834, "longitude": 113.86335426209128 }, { "latitude": 34.756895567875986, "longitude": 113.60263517565484 }, { "latitude": 34.70090807105177, "longitude": 113.57962816118891 }, { "latitude": 34.77860074273182, "longitude": 113.4503344384824 }, { "latitude": 34.768479430066925, "longitude": 113.5971369815796 }, { "latitude": 34.76954194006588, "longitude": 113.47001275372205 }, { "latitude": 34.7355093970351, "longitude": 113.70212021670118 }, { "latitude": 34.72516062237599, "longitude": 113.68366364549303 }, { "latitude": 34.716694948017526, "longitude": 113.77466646785504 }, { "latitude": 34.754865584692794, "longitude": 113.406903925529 }];
    var wuhan = [{ "latitude": 30.546706635667118, "longitude": 114.18702427018235 }, { "latitude": 30.53239392342654, "longitude": 114.17685117820224 }, { "latitude": 30.594543253586156, "longitude": 114.56041507501197 }, { "latitude": 30.56151545961959, "longitude": 114.31923625512704 }, { "latitude": 30.52321406891785, "longitude": 114.47566766650566 }, { "latitude": 30.564484989755133, "longitude": 114.22462828996 }, { "latitude": 30.574298457838715, "longitude": 114.2622723001337 }, { "latitude": 30.580411149342844, "longitude": 114.51558089363196 }, { "latitude": 30.627878317139455, "longitude": 114.27496080640444 }, { "latitude": 30.573585465164015, "longitude": 114.19946912140612 }, { "latitude": 30.567446222689153, "longitude": 114.37138283918642 }, { "latitude": 30.558004132889014, "longitude": 114.11204731713673 }, { "latitude": 30.57890561082618, "longitude": 114.20915810135466 }, { "latitude": 30.56332501656743, "longitude": 114.0933788968463 }, { "latitude": 30.55147817412867, "longitude": 114.28302537824426 }, { "latitude": 30.578130664880693, "longitude": 114.22284190422056 }, { "latitude": 30.563457727718085, "longitude": 114.54944679220185 }, { "latitude": 30.59328690537093, "longitude": 114.15877257101667 }, { "latitude": 30.572676092324645, "longitude": 114.15697581932235 }, { "latitude": 30.52369466017109, "longitude": 114.33652627883626 }, { "latitude": 30.523214524539316, "longitude": 114.24710592395816 }, { "latitude": 30.609321369498478, "longitude": 114.21269583926289 }, { "latitude": 30.591346160239286, "longitude": 114.28415066591053 }, { "latitude": 30.620662938119363, "longitude": 114.15652998670298 }, { "latitude": 30.59301246370067, "longitude": 114.2972908529556 }, { "latitude": 30.59924149825787, "longitude": 114.168387624838 }, { "latitude": 30.544296333553582, "longitude": 114.44090783235956 }, { "latitude": 30.569783003398552, "longitude": 114.18964879114081 }, { "latitude": 30.576653245629878, "longitude": 114.36323727240105 }, { "latitude": 30.56520273054929, "longitude": 114.50492627837743 }, { "latitude": 30.563600284270333, "longitude": 114.13448669992218 }, { "latitude": 30.56642705611195, "longitude": 114.20570377730823 }, { "latitude": 30.56580601798645, "longitude": 114.14852974056073 }, { "latitude": 30.571301660500136, "longitude": 114.50260257780673 }, { "latitude": 30.571572918941694, "longitude": 114.52330926642038 }, { "latitude": 30.585073096875586, "longitude": 114.53750095411283 }, { "latitude": 30.578761429547086, "longitude": 114.2280903486693 }, { "latitude": 30.558703234164103, "longitude": 114.31745550797028 }, { "latitude": 30.626554215400855, "longitude": 114.43335222081053 }, { "latitude": 30.5943534037253, "longitude": 114.42076141333445 }, { "latitude": 30.61174185837948, "longitude": 114.39725266925308 }, { "latitude": 30.612862341345156, "longitude": 114.29961243273563 }, { "latitude": 30.636257218601944, "longitude": 114.17559460072826 }, { "latitude": 30.562971948221186, "longitude": 114.32066689456285 }, { "latitude": 30.52574862676815, "longitude": 114.20870660442509 }, { "latitude": 30.58491475455933, "longitude": 114.25614811545948 }, { "latitude": 30.636553676585418, "longitude": 114.52387634646378 }, { "latitude": 30.583523300987842, "longitude": 114.27499283130278 }, { "latitude": 30.598307007600315, "longitude": 114.51298098043164 }, { "latitude": 30.639213418881912, "longitude": 114.19777314875805 }, { "latitude": 30.564826227006535, "longitude": 114.18544367501906 }, { "latitude": 30.613968987078877, "longitude": 114.15994165053334 }, { "latitude": 30.573134548302367, "longitude": 114.3002754049732 }, { "latitude": 30.6047309968468, "longitude": 114.33181970826756 }, { "latitude": 30.556841572368477, "longitude": 114.48532817753838 }, { "latitude": 30.552534541729887, "longitude": 114.2777999530475 }, { "latitude": 30.610684665751382, "longitude": 114.13443017360316 }, { "latitude": 30.555628979839994, "longitude": 114.17202269828768 }, { "latitude": 30.62585261390943, "longitude": 114.17717001343787 }, { "latitude": 30.609481197029282, "longitude": 114.55082254112577 }, { "latitude": 30.534216217989968, "longitude": 114.47898326920237 }, { "latitude": 30.604881922970065, "longitude": 114.38599985608492 }, { "latitude": 30.586469854487625, "longitude": 114.36151612403066 }, { "latitude": 30.594375575615008, "longitude": 114.49238188356219 }, { "latitude": 30.535151728860594, "longitude": 114.22143255026809 }, { "latitude": 30.623552808354766, "longitude": 114.38537466820264 }, { "latitude": 30.621563148360433, "longitude": 114.24709675344035 }, { "latitude": 30.613662226807392, "longitude": 114.30350414775695 }, { "latitude": 30.60640925700984, "longitude": 114.2399456861918 }, { "latitude": 30.620171316146184, "longitude": 114.34669960996256 }, { "latitude": 30.568392917310327, "longitude": 114.24569144157432 }, { "latitude": 30.593716405236627, "longitude": 114.46829065997606 }, { "latitude": 30.574793137859505, "longitude": 114.27108910352017 }, { "latitude": 30.549841038942915, "longitude": 114.16401434251132 }, { "latitude": 30.580121326854442, "longitude": 114.11281652461489 }, { "latitude": 30.522748140532954, "longitude": 114.1019034033702 }, { "latitude": 30.601573566649733, "longitude": 114.55699775664587 }, { "latitude": 30.548371198975772, "longitude": 114.35140067704157 }, { "latitude": 30.529957866122064, "longitude": 114.19318603582623 }, { "latitude": 30.562390514825235, "longitude": 114.52246007940873 }, { "latitude": 30.600882230380854, "longitude": 114.08293343933609 }, { "latitude": 30.557655029832585, "longitude": 114.28759814625384 }, { "latitude": 30.555759293246513, "longitude": 114.15463504178788 }, { "latitude": 30.525493074498524, "longitude": 114.17875537634828 }, { "latitude": 30.633163201308243, "longitude": 114.39833342823515 }, { "latitude": 30.535325348984777, "longitude": 114.18610143717542 }, { "latitude": 30.614555898084483, "longitude": 114.44541216490781 }, { "latitude": 30.56215473813381, "longitude": 114.1511251738153 }, { "latitude": 30.600633968936492, "longitude": 114.24408485814322 }, { "latitude": 30.629804604532644, "longitude": 114.2235188029915 }, { "latitude": 30.582736714378974, "longitude": 114.22455203233083 }, { "latitude": 30.58637134242205, "longitude": 114.19483441090587 }, { "latitude": 30.62085946970749, "longitude": 114.43709869501646 }, { "latitude": 30.599361656153427, "longitude": 114.54099627173139 }, { "latitude": 30.564607672028725, "longitude": 114.30384930843161 }, { "latitude": 30.556929691078714, "longitude": 114.24125520882734 }, { "latitude": 30.593213644643527, "longitude": 114.29827260712467 }, { "latitude": 30.540851010067446, "longitude": 114.11329030076655 }, { "latitude": 30.54733222593861, "longitude": 114.20178943589 }, { "latitude": 30.586200181836148, "longitude": 114.4137751414832 }];
    var nanjing = [{ "latitude": 32.03984441886924, "longitude": 118.7620969257729 }, { "latitude": 32.035864458938356, "longitude": 118.98847708671065 }, { "latitude": 32.07855680787762, "longitude": 118.92088117047874 }, { "latitude": 32.07099117615156, "longitude": 118.89781042819187 }, { "latitude": 31.991730972218114, "longitude": 118.92875578666111 }, { "latitude": 32.03194014204663, "longitude": 118.84452460004896 }, { "latitude": 32.033243811095666, "longitude": 118.9755725720923 }, { "latitude": 32.05297954551997, "longitude": 118.83079276818121 }, { "latitude": 32.09882403467989, "longitude": 118.78332468760001 }, { "latitude": 32.01819999600929, "longitude": 118.56147024790057 }, { "latitude": 31.99537821002426, "longitude": 119.00621117167792 }, { "latitude": 32.08761640404191, "longitude": 118.61700762324746 }, { "latitude": 32.01692312465168, "longitude": 119.03270376328653 }, { "latitude": 32.06834452680736, "longitude": 118.7358085361418 }, { "latitude": 32.00284202804079, "longitude": 118.83457860989247 }, { "latitude": 32.03893825813118, "longitude": 118.74471271036032 }, { "latitude": 31.987741319931697, "longitude": 118.73521044303064 }, { "latitude": 31.99497577532851, "longitude": 118.95767233994341 }, { "latitude": 32.03690578929448, "longitude": 118.96401762252316 }, { "latitude": 32.08691931228188, "longitude": 118.54603562028383 }, { "latitude": 32.020527746007346, "longitude": 118.55397135329474 }, { "latitude": 32.04865844671136, "longitude": 118.83608766332055 }, { "latitude": 32.07898130375577, "longitude": 118.64536816615984 }, { "latitude": 32.014030331257445, "longitude": 118.90324384940044 }, { "latitude": 32.089310951495435, "longitude": 118.72630299222955 }, { "latitude": 32.04617333507539, "longitude": 119.01355086975344 }, { "latitude": 32.09893054519635, "longitude": 118.61772801018269 }, { "latitude": 32.088834931077564, "longitude": 118.79691314871422 }, { "latitude": 32.07016233937707, "longitude": 118.82072501671611 }, { "latitude": 32.03108157372447, "longitude": 118.95609358175122 }, { "latitude": 32.01311787639459, "longitude": 118.89394583228389 }, { "latitude": 32.102500883419616, "longitude": 118.76310671407957 }, { "latitude": 32.09697954516897, "longitude": 118.91281026924099 }, { "latitude": 32.08674645203926, "longitude": 118.61694546191049 }, { "latitude": 32.00936022370162, "longitude": 118.77153454800357 }, { "latitude": 32.026655520320666, "longitude": 118.8189133400758 }, { "latitude": 32.02184070553102, "longitude": 118.89217674294028 }, { "latitude": 32.05393717378838, "longitude": 118.79753725213021 }, { "latitude": 31.987289650428444, "longitude": 119.03408328252193 }, { "latitude": 32.025945441990636, "longitude": 118.97478548800996 }, { "latitude": 32.083594865007726, "longitude": 118.90730559153711 }, { "latitude": 32.03178439328423, "longitude": 118.84767252354985 }, { "latitude": 32.08012352952366, "longitude": 118.72704242323947 }, { "latitude": 32.082903480976356, "longitude": 118.68640312480424 }, { "latitude": 32.011513957834794, "longitude": 118.87384151783161 }, { "latitude": 32.03688523770357, "longitude": 118.99567082422851 }, { "latitude": 32.0279510870003, "longitude": 118.75921204683185 }, { "latitude": 32.03874892006239, "longitude": 118.57260657733782 }, { "latitude": 32.065231781927324, "longitude": 118.78928204493239 }, { "latitude": 32.00569466200827, "longitude": 118.80231327196395 }, { "latitude": 32.02571932394423, "longitude": 118.6529243982403 }, { "latitude": 32.00314092841294, "longitude": 118.9494828050357 }, { "latitude": 31.989076486456394, "longitude": 118.81657718460097 }, { "latitude": 32.05137491537627, "longitude": 118.72949396464911 }, { "latitude": 32.01265834097386, "longitude": 118.79865622859569 }, { "latitude": 32.09561257845379, "longitude": 118.60154562920329 }, { "latitude": 32.081016054937784, "longitude": 118.78196036885397 }, { "latitude": 32.09134735118642, "longitude": 118.81840255900214 }, { "latitude": 31.989527378097613, "longitude": 118.62764363612764 }, { "latitude": 32.041733067160834, "longitude": 119.03724892092285 }, { "latitude": 32.06437097723756, "longitude": 118.90045581431498 }, { "latitude": 32.00802873412436, "longitude": 118.83336951973023 }, { "latitude": 31.99904761082083, "longitude": 118.77941739857368 }, { "latitude": 32.02641316500332, "longitude": 118.91279705087499 }, { "latitude": 32.10079864666818, "longitude": 118.8385902565607 }, { "latitude": 32.09016648580461, "longitude": 118.6695113072764 }, { "latitude": 32.06858108298043, "longitude": 118.97974420787055 }, { "latitude": 32.08356696521669, "longitude": 118.87045207921501 }, { "latitude": 32.01094869888418, "longitude": 118.86193078521922 }, { "latitude": 32.04162987678821, "longitude": 118.69276912009904 }, { "latitude": 32.09738608901625, "longitude": 118.58869312858995 }, { "latitude": 32.0187843910615, "longitude": 118.84850103014269 }, { "latitude": 32.05491932869335, "longitude": 118.98880347964624 }, { "latitude": 32.076969809259836, "longitude": 118.94589896124586 }, { "latitude": 32.00884470220182, "longitude": 118.55058357001118 }, { "latitude": 32.04353399300946, "longitude": 118.81712205886659 }, { "latitude": 32.034842257773235, "longitude": 118.8374505311875 }, { "latitude": 32.0495930553856, "longitude": 118.99932665598517 }, { "latitude": 32.05754549162872, "longitude": 118.5732584242283 }, { "latitude": 32.027807632052266, "longitude": 118.83404321514624 }, { "latitude": 32.08240358170911, "longitude": 118.70470924397314 }, { "latitude": 32.008678268219974, "longitude": 118.81559523526096 }, { "latitude": 32.095523727515086, "longitude": 118.6358143018319 }, { "latitude": 32.028101625016426, "longitude": 118.65481366423387 }, { "latitude": 32.01528496271241, "longitude": 118.94637354861726 }, { "latitude": 32.03742815177886, "longitude": 119.02165117980509 }, { "latitude": 32.09206065921609, "longitude": 118.69391458762786 }, { "latitude": 32.007274855829095, "longitude": 118.95257991579703 }, { "latitude": 32.05391840232812, "longitude": 118.68601637761265 }, { "latitude": 32.04419826293449, "longitude": 118.87094324852632 }, { "latitude": 32.06885150908423, "longitude": 118.9247035072826 }, { "latitude": 32.0113073931398, "longitude": 118.9472085789443 }, { "latitude": 32.00895109628351, "longitude": 118.5772973380302 }, { "latitude": 32.02949190550959, "longitude": 119.01202311747947 }, { "latitude": 31.998545908440814, "longitude": 118.75347830831097 }, { "latitude": 32.05733594311748, "longitude": 118.84715898671243 }, { "latitude": 32.07087543463672, "longitude": 118.56778985322848 }, { "latitude": 32.05987723620297, "longitude": 118.73152421540526 }, { "latitude": 32.0281132310207, "longitude": 118.76051884427578 }, { "latitude": 32.100423836974485, "longitude": 118.84521060354426 }];
    var shanghai = [{ "latitude": 31.319522486841038, "longitude": 121.25753237201508 }, { "latitude": 31.294247596015893, "longitude": 121.37798305482751 }, { "latitude": 31.29311201758615, "longitude": 121.58201879406553 }, { "latitude": 31.20036189781444, "longitude": 121.66282636997012 }, { "latitude": 31.353984634617408, "longitude": 121.12511420142471 }, { "latitude": 31.1588936670341, "longitude": 121.08602726839467 }, { "latitude": 31.298799913380847, "longitude": 120.9709639212388 }, { "latitude": 31.167031912005903, "longitude": 121.75978850706726 }, { "latitude": 31.18175956191998, "longitude": 121.35256023926092 }, { "latitude": 31.194899119723758, "longitude": 121.55660031211725 }, { "latitude": 31.328480325548426, "longitude": 121.10144230779252 }, { "latitude": 31.32669410453945, "longitude": 121.74137267537355 }, { "latitude": 31.220914901474583, "longitude": 121.67491644161832 }, { "latitude": 31.283714331569843, "longitude": 121.04148388449764 }, { "latitude": 31.18502936282528, "longitude": 121.77410813918718 }, { "latitude": 31.285604729508208, "longitude": 121.76306290937951 }, { "latitude": 31.23387622237097, "longitude": 121.13650217960297 }, { "latitude": 31.277179695929576, "longitude": 120.91493150421928 }, { "latitude": 31.169204989090556, "longitude": 121.04398125417089 }, { "latitude": 31.259890641707454, "longitude": 121.67197233563769 }, { "latitude": 31.367979833602334, "longitude": 121.1658513413076 }, { "latitude": 31.330424241498797, "longitude": 121.13529272249464 }, { "latitude": 31.234130672123047, "longitude": 121.25446465733252 }, { "latitude": 31.29370921236423, "longitude": 121.1977854562822 }, { "latitude": 31.345899777966515, "longitude": 121.02980105559367 }, { "latitude": 31.24445272589403, "longitude": 121.8350599686385 }, { "latitude": 31.223659319614438, "longitude": 121.09128674810874 }, { "latitude": 31.21355326473199, "longitude": 121.52101176408527 }, { "latitude": 31.381858059607747, "longitude": 121.15805744189176 }, { "latitude": 31.320754206609866, "longitude": 121.78804011164931 }, { "latitude": 31.17469539720513, "longitude": 121.47712169042325 }, { "latitude": 31.31101786102738, "longitude": 121.53774934632364 }, { "latitude": 31.354022052156147, "longitude": 120.97560576481015 }, { "latitude": 31.15245197604672, "longitude": 121.75521872636112 }, { "latitude": 31.206644348271503, "longitude": 121.59575645053283 }, { "latitude": 31.151312883620868, "longitude": 121.57659986783939 }, { "latitude": 31.253728292578273, "longitude": 121.09262290688692 }, { "latitude": 31.240431769340894, "longitude": 121.77906130977482 }, { "latitude": 31.36435805765115, "longitude": 121.22349004379825 }, { "latitude": 31.242660392148622, "longitude": 121.04669187392105 }, { "latitude": 31.194031571962164, "longitude": 120.93171482117005 }, { "latitude": 31.189533941268923, "longitude": 121.20716196857083 }, { "latitude": 31.338538171932907, "longitude": 120.91920806864881 }, { "latitude": 31.333047815552753, "longitude": 121.24090213701376 }, { "latitude": 31.228420006985516, "longitude": 121.05421724525239 }, { "latitude": 31.30066541870708, "longitude": 121.80328868650798 }, { "latitude": 31.371544739851938, "longitude": 120.9419230437433 }, { "latitude": 31.367507284184352, "longitude": 121.12030063929568 }, { "latitude": 31.235259708648943, "longitude": 120.94982199282137 }, { "latitude": 31.220674485725475, "longitude": 121.32174221253314 }, { "latitude": 31.250821627731067, "longitude": 121.37112070837898 }, { "latitude": 31.313329843113394, "longitude": 121.62710871816564 }, { "latitude": 31.37981641601593, "longitude": 121.16811022585375 }, { "latitude": 31.19959104094263, "longitude": 120.9340020540059 }, { "latitude": 31.167422798369206, "longitude": 121.14124941552348 }, { "latitude": 31.164087347327722, "longitude": 121.50358610568779 }, { "latitude": 31.3136706218446, "longitude": 121.07378243804592 }, { "latitude": 31.25648222606467, "longitude": 121.79418188211602 }, { "latitude": 31.222551074227972, "longitude": 121.46130625182647 }, { "latitude": 31.341511321795405, "longitude": 121.74016483734975 }, { "latitude": 31.159571946324814, "longitude": 120.96387176145586 }, { "latitude": 31.34281607354565, "longitude": 121.80512903221488 }, { "latitude": 31.15950088118876, "longitude": 121.74197010910338 }, { "latitude": 31.178747838746798, "longitude": 121.16096234537959 }, { "latitude": 31.353766650837212, "longitude": 121.65495321825988 }, { "latitude": 31.260796999955545, "longitude": 121.71962954274223 }, { "latitude": 31.155175729356387, "longitude": 121.45731980895778 }, { "latitude": 31.20845875564053, "longitude": 121.59312389668814 }, { "latitude": 31.32732675469185, "longitude": 121.03191828635426 }, { "latitude": 31.171290714654813, "longitude": 121.56040267348837 }, { "latitude": 31.19916883770142, "longitude": 120.92515255697386 }, { "latitude": 31.244440159875857, "longitude": 121.70273216783986 }, { "latitude": 31.1799033691819, "longitude": 121.82559469571045 }, { "latitude": 31.278933000985255, "longitude": 120.98688287776805 }, { "latitude": 31.151606482109205, "longitude": 120.93468724983508 }, { "latitude": 31.257334941511836, "longitude": 121.37535233331808 }, { "latitude": 31.154276888457048, "longitude": 121.60413044504143 }, { "latitude": 31.208547704262877, "longitude": 121.05653039447186 }, { "latitude": 31.198719737587798, "longitude": 121.2417275526634 }, { "latitude": 31.20618517668093, "longitude": 121.7111190054071 }, { "latitude": 31.301602831118466, "longitude": 121.20330309245784 }, { "latitude": 31.2464907220884, "longitude": 121.7081397697163 }, { "latitude": 31.232230314530295, "longitude": 121.28163917792328 }, { "latitude": 31.223066423821578, "longitude": 121.54327254393961 }, { "latitude": 31.291982979293984, "longitude": 120.98866030227947 }, { "latitude": 31.163205087949525, "longitude": 121.52421969167582 }, { "latitude": 31.298693692778116, "longitude": 121.74506108069308 }, { "latitude": 31.240730681251698, "longitude": 121.80793852611265 }, { "latitude": 31.157424317776183, "longitude": 120.91754707839853 }, { "latitude": 31.27995765252477, "longitude": 121.17678579354308 }, { "latitude": 31.25341217294536, "longitude": 121.40222561320975 }, { "latitude": 31.37275021966173, "longitude": 120.94116523744535 }, { "latitude": 31.176113082903054, "longitude": 121.18456833697496 }, { "latitude": 31.347844068988255, "longitude": 121.78947936557755 }, { "latitude": 31.36652356689063, "longitude": 121.77906770460096 }, { "latitude": 31.360063180401887, "longitude": 121.01002929507571 }, { "latitude": 31.18532925096521, "longitude": 121.62208300969752 }, { "latitude": 31.30905733345599, "longitude": 121.63128017347343 }, { "latitude": 31.31736540185196, "longitude": 120.9471256076197 }, { "latitude": 31.263201366316167, "longitude": 121.23275025857403 }];

    (function fn(data, city, zoom) {
        var args = [];
        (function add(i, data, city, zoom, callback) {
            if (data && data[i]) {
                var point = data[i];
                i += 1;
                WebApplication.WebService.AddDevice(city + i * 100, point.longitude, point.latitude, city, zoom, function (ret) {
                    console.log(i, ret);
                    add(i, data, city, zoom, callback);
                }, function (err) {
                    console.error(err);
                });
            } else {
                callback(add);
            }
        })(0, data, city, zoom, function callback(add) {
            if (args.length > 0) {
                var arg = args.shift();
                add(0, arg[0], arg[1], arg[2], callback);
            } else {
                window.location.reload();
            }
        });
        return function next() {
            args.push(Array.prototype.slice.call(arguments));
            return next;
        };
    })(shanghai, "上海", "12")(nanjing, "南京", "12")(wuhan, "武汉", "12")(zhengzhou, "郑州", "12");
}